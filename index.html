
<!DOCTYPE html>
<html lang="ja">
  <head>
    <!-- include head -->
    

<meta charset="utf-8">
<title>ハタさんのブログ(出張版)</title>
<meta name="author" content="Yusuke Hata">
<meta name="description"
      content="Io Languageでタイマー Apr 14th, 2013 Ioを使っていていつも思うのが、どうやってタイマーを実装するか。という問題 たとえば、3秒毎に特定の処理をしたくなった時、こんなコードを書いてしまいたくなる 1
2
3
4
5
6
7
loop ( proc1 proc2 &hellip;">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="canonical" href="http://nowelium.github.com/index.html">
<link href="/favicon.png" rel="icon">
<link href="/stylesheets/screen.css"
      media="screen, projection"
      rel="stylesheet"
      type="text/css">
<link href="/atom.xml"
      rel="alternate"
      title="ハタさんのブログ(出張版)"
      type="application/atom+xml">

<style type="text/css">
  header[role="banner"] hgroup h1 {
    /* font-size: 180% */
    color: #999;
  }
</style>


<script src="/javascripts/modernizr-2.0.js" type="text/javascript"></script>
<script src="/javascripts/ender.js" type="text/javascript"></script>
<script src="/javascripts/octopress.js" type="text/javascript"></script>



    <!-- /include -->
  </head>
  <body>
    <div id="wrapper">

      <header role="banner" class="site_metas">
	<!-- include header -->
	
<hgroup>
  <h1><a href="/">ハタさんのブログ(出張版)</a></h1>
  
</hgroup>

	<!-- /include -->
        <!-- include social_service_links -->
	
<div id="social-links">
  <ul>
    
    <li id="social-links-github">
      <a title="GitHub" href="https://github.com/nowelium">GitHub</a>
    </li>
    
    
    <li id="social-links-twitter">
      <a title="twitter" href="http://twitter.com/nowelium">twitter</a>
    </li>
    
    <li id="social-links-feed">
      <a title="feed" href="http://nowelium.github.com/atom.xml">feed</a>
    </li>
  </ul>
</div>

        <!-- /include -->
      </header>

      <div id="content">
	<!-- content -->
	<div id="page">
  <div id="top">

  
  
  
    <article class="hentry" role="article">
      
  <header>
    
      <h1 class="entry-title">Io Languageでタイマー</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-14T20:34:00+09:00" pubdate data-updated="true">Apr 14<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Ioを使っていていつも思うのが、どうやってタイマーを実装するか。という問題</p>

<p>たとえば、3秒毎に特定の処理をしたくなった時、こんなコードを書いてしまいたくなる</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">loop</span> <span class="o">(</span>
</span><span class='line'>  <span class="n">proc1</span>
</span><span class='line'>  <span class="n">proc2</span>
</span><span class='line'>  <span class="n">proc3</span>
</span><span class='line'>  <span class="err">:</span>
</span><span class='line'>  <span class="n">wait</span><span class="o">(</span><span class="mf">3</span><span class="o">)</span>
</span><span class='line'><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>一見動いてしまうけど<br/>
でも、これは実はダメで loop でブロックされてしまうし、 <code>wait</code> 時にスレッドがブロックされてしまう</p>

<p>もうかれこれ3年くらい前に実装したものが↓<br/>
<a href="http://coderepos.org/share/browser/lang/io/Timer">/lang/io/Timer – CodeRepos::Share – Trac</a></p>

<div><script src='https://gist.github.com/5382432.js?file='></script>
<noscript><pre><code></code></pre></noscript></div>


<p>まぁ、なんとなく動くんだけど、<code>System sleep</code> や <code>wait</code> は全体がブロックされてしまう問題があり
同時並行性に問題があった</p>

<p>ということで、これをどうにかして解決したいなぁ。と3年ぶりに思い至り
<code>Concurrency Thread</code> でどうにか出来るんじゃないか。ということで、 non-blocking な実装を考えてみた</p>

<div><script src='https://gist.github.com/5382439.js?file='></script>
<noscript><pre><code></code></pre></noscript></div>


<p>実装としては、親スレッドで 時間を受け取る Server を立ててしまって、子スレッドを生成して<br/>
その子スレッド内で <code>sleep</code> すれば親スレッドをブロックさせないという仕掛け</p>

<p>親スレッドはこんな感じに作っておいて</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">Timer</span> <span class="n">Interval</span> <span class="n">Loop</span> <span class="o">:=</span> <span class="n">Server</span> <span class="k">clone</span> <span class="k">do</span> <span class="o">(</span>
</span><span class='line'>  <span class="n">setPort</span><span class="o">(</span><span class="mf">11002</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">listener</span> <span class="o">:=</span> <span class="n">Map</span> <span class="k">clone</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">addListener</span> <span class="o">:=</span> <span class="k">method</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">callback</span><span class="o">,</span>
</span><span class='line'>    <span class="n">listener</span> <span class="n">atPut</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">callback</span><span class="o">)</span>
</span><span class='line'>  <span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Handler</span> <span class="o">:=</span> <span class="n">Object</span> <span class="k">clone</span> <span class="k">do</span> <span class="o">(</span>
</span><span class='line'>    <span class="n">handle</span> <span class="o">:=</span> <span class="k">method</span><span class="o">(</span><span class="n">socket</span><span class="o">,</span> <span class="n">server</span><span class="o">,</span>
</span><span class='line'>      <span class="n">while</span><span class="o">(</span><span class="n">socket</span> <span class="n">isOpen</span><span class="o">,</span>
</span><span class='line'>        <span class="k">if</span><span class="o">(</span><span class="n">socket</span> <span class="n">read</span><span class="o">)</span> <span class="k">then</span> <span class="o">(</span>
</span><span class='line'>          <span class="n">data</span> <span class="o">:=</span> <span class="n">socket</span> <span class="n">readBuffer</span>
</span><span class='line'>          <span class="n">id</span> <span class="o">:=</span> <span class="n">data</span> <span class="n">beforeSeq</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">)</span>
</span><span class='line'>          <span class="n">timestamp</span> <span class="o">:=</span> <span class="n">data</span> <span class="n">afterSeq</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">)</span>
</span><span class='line'>          <span class="k">if</span><span class="o">(</span><span class="n">server</span> <span class="n">listener</span> <span class="n">hasKey</span><span class="o">(</span><span class="n">id</span><span class="o">))</span> <span class="k">then</span> <span class="o">(</span>
</span><span class='line'>            <span class="n">callback</span> <span class="o">:=</span> <span class="n">server</span> <span class="n">listener</span> <span class="n">at</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
</span><span class='line'>            <span class="n">callback</span> <span class="o">@</span><span class="n">call</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">timestamp</span> <span class="n">asNumber</span><span class="o">)</span>
</span><span class='line'>          <span class="o">)</span>
</span><span class='line'>        <span class="o">)</span>
</span><span class='line'>        <span class="n">socket</span> <span class="n">readBuffer</span> <span class="n">empty</span>
</span><span class='line'>      <span class="o">)</span>
</span><span class='line'>      <span class="n">socket</span> <span class="n">close</span>
</span><span class='line'>    <span class="o">)</span>
</span><span class='line'>  <span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">handleSocket</span> <span class="o">:=</span> <span class="k">method</span><span class="o">(</span><span class="n">socket</span><span class="o">,</span> <span class="n">Handler</span> <span class="k">clone</span> <span class="o">@</span><span class="n">handle</span><span class="o">(</span><span class="n">socket</span><span class="o">,</span> <span class="n">self</span><span class="o">))</span>
</span><span class='line'><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>子スレッドはソケットで書き込んであげている</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span> <span class="n">createThread</span><span class="o">(</span><span class="s">&quot;&quot;&quot;</span>
</span><span class='line'><span class="s">  id := &quot;</span><span class="c1">#{id}&quot;</span>
</span><span class='line'>  <span class="n">host</span> <span class="o">:=</span> <span class="s">&quot;localhost&quot;</span>
</span><span class='line'>  <span class="n">port</span> <span class="o">:=</span> <span class="c1">#{Timer Interval Loop port}</span>
</span><span class='line'>  <span class="n">interval</span> <span class="o">:=</span> <span class="c1">#{interval}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">socket</span> <span class="o">:=</span> <span class="n">Socket</span> <span class="k">clone</span>
</span><span class='line'>  <span class="n">socket</span> <span class="n">setHost</span><span class="o">(</span><span class="n">host</span><span class="o">)</span>
</span><span class='line'>  <span class="n">socket</span> <span class="n">setPort</span><span class="o">(</span><span class="n">port</span><span class="o">)</span>
</span><span class='line'>  <span class="n">socket</span> <span class="n">connect</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="o">(</span><span class="n">socket</span> <span class="n">isOpen</span><span class="o">)</span> <span class="k">then</span> <span class="o">(</span>
</span><span class='line'>    <span class="s">&quot;client connected&quot;</span> <span class="n">println</span>
</span><span class='line'>  <span class="o">)</span> <span class="k">else</span> <span class="o">(</span>
</span><span class='line'>    <span class="n">Exception</span> <span class="n">raise</span><span class="o">(</span><span class="s">&quot;connection failed&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">timestamp</span> <span class="o">:=</span> <span class="n">Date</span> <span class="n">now</span> <span class="n">asNumberString</span>
</span><span class='line'>  <span class="n">msg</span> <span class="o">:=</span> <span class="s">&quot;\#\{id\}:\#\{timestamp\}&quot;</span>
</span><span class='line'>  <span class="n">loop</span><span class="o">(</span>
</span><span class='line'>    <span class="n">timestamp</span> <span class="o">:=</span> <span class="n">Date</span> <span class="n">now</span> <span class="n">asNumberString</span>
</span><span class='line'>    <span class="n">socket</span> <span class="n">write</span><span class="o">(</span><span class="n">msg</span> <span class="n">interpolate</span><span class="o">)</span>
</span><span class='line'>    <span class="n">wait</span><span class="o">(</span><span class="n">interval</span><span class="o">)</span>
</span><span class='line'>  <span class="o">)</span>
</span><span class='line'><span class="s">&quot;&quot;</span><span class="err">&quot;</span> <span class="n">interpolate</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>まぁ、時間でブロックされずにコールバックをとれる javascript の <code>setTimeout</code> と <code>setInterval</code> がすごいなぁ。ってのとそれをどうやって io で作ろうかなと思った奮闘記</p>
</div>
  
  <footer style="text-align: right">
    <a rel="full-article" href="/blog/2013/04/14/io-nonblocking-timer.html">permalink</a>
  </footer>


    </article>
  
  
    <article class="hentry" role="article">
      
  <header>
    
      <h1 class="entry-title">Io Language で Yielding</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-16T22:39:00+09:00" pubdate data-updated="true">Sep 16<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>とある言語で generator が入るらしいというのをみてしまった。<br/>
generator + yielding の仕組みらしい。なにそれ python。<br/>
(内部イテレータや外部イテレータについてはここでは触れない感じです。)</p>

<h1>Generator + yield</h1>

<p>ジェネレータは、僕の認識だと closure のような仕組みに yielding できるインタフェースを用意したものだと思ってる<br/>
それゆえ yielding で使う構文である <code>yield</code> さんを単体で使うというよりセットで使っているものが多そう</p>

<p>例えば、こんな感じのループとか</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">##### python</span>
</span><span class='line'><span class="k">def</span> <span class="nf">gen</span><span class="p">():</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span class='line'>    <span class="k">print</span> <span class="n">i</span>
</span><span class='line'>    <span class="k">yield</span>
</span><span class='line'>
</span><span class='line'><span class="n">hoge</span> <span class="o">=</span> <span class="n">gen</span><span class="p">()</span>
</span><span class='line'><span class="n">hoge</span><span class="o">.</span><span class="n">next</span><span class="p">()</span> <span class="c"># =&gt; 0</span>
</span><span class='line'><span class="n">hoge</span><span class="o">.</span><span class="n">next</span><span class="p">()</span> <span class="c"># =&gt; 1</span>
</span><span class='line'><span class="n">hoge</span><span class="o">.</span><span class="n">next</span><span class="p">()</span> <span class="c"># =&gt; 2</span>
</span></code></pre></td></tr></table></div></figure>


<p>なので、 <code>yield</code> 単体でも動きそうで動かない</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">yielding</span><span class="p">():</span>
</span><span class='line'>  <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
</span><span class='line'>    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">print</span> <span class="n">i</span>
</span><span class='line'>    <span class="k">yield</span>
</span><span class='line'>
</span><span class='line'><span class="n">yielding</span><span class="p">()</span>
</span><span class='line'><span class="n">yielding</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h1>io での yield</h1>

<p>IoLanguage における yield は、単なるコンテキストスイッチ(というか、キューイングされた次の処理の実行(シングルスレッドで実行されるtimerのような))に近い感じがしている</p>

<p>先ほど書いた python のコードは、io だと全然違う動きをする</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">yielding</span> <span class="o">:=</span> <span class="n">block</span><span class="o">(</span>
</span><span class='line'>  <span class="k">for</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="mf">0</span><span class="o">,</span> <span class="mf">3</span><span class="o">,</span>
</span><span class='line'>    <span class="n">i</span> <span class="n">println</span>
</span><span class='line'>    <span class="n">yield</span>
</span><span class='line'>  <span class="o">)</span>
</span><span class='line'><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">yielding</span> <span class="n">call</span><span class="o">()</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// =&gt;[results]</span>
</span><span class='line'><span class="mf">0</span>
</span><span class='line'><span class="mf">1</span>
</span><span class='line'><span class="mf">2</span>
</span><span class='line'><span class="mf">3</span>
</span></code></pre></td></tr></table></div></figure>


<p>全然 yield してないです..<br/>
あくまで一つの処理を終えてから、次の処理に行こうとしてそうです。(yieldで止まらない)</p>

<p>ということで、呼び出し自体を非同期にする <code>@</code> とか <code>@@</code> を使います</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">yielding</span> <span class="o">:=</span> <span class="n">block</span><span class="o">(</span>
</span><span class='line'>  <span class="k">for</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="mf">0</span><span class="o">,</span> <span class="mf">3</span><span class="o">,</span>
</span><span class='line'>    <span class="n">i</span> <span class="n">println</span>
</span><span class='line'>    <span class="n">yield</span>
</span><span class='line'>  <span class="o">)</span>
</span><span class='line'><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">yielding</span> <span class="o">@@</span><span class="n">call</span>
</span><span class='line'><span class="n">yield</span> <span class="c1">// async call を元処理に戻す</span>
</span><span class='line'><span class="n">yield</span> <span class="c1">// 次の yield を呼び出す</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// =&gt; [results]</span>
</span><span class='line'><span class="mf">0</span>
</span><span class='line'><span class="mf">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>loop でも使える</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">count</span> <span class="o">:=</span> <span class="n">block</span><span class="o">(</span>
</span><span class='line'>  <span class="n">counter</span> <span class="o">:=</span> <span class="mf">0</span>
</span><span class='line'>  <span class="n">loop</span><span class="o">(</span>
</span><span class='line'>    <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mf">1</span>
</span><span class='line'>    <span class="n">counter</span> <span class="n">println</span>
</span><span class='line'>    <span class="n">yield</span>
</span><span class='line'>  <span class="o">)</span>
</span><span class='line'><span class="o">)</span>
</span><span class='line'><span class="n">count</span> <span class="o">@</span><span class="n">call</span>
</span><span class='line'><span class="n">yield</span> <span class="c1">// =&gt; 1</span>
</span><span class='line'><span class="n">yield</span> <span class="c1">// =&gt; 2</span>
</span><span class='line'><span class="n">yield</span> <span class="c1">// =&gt; 3</span>
</span></code></pre></td></tr></table></div></figure>


<p>yield とひとくくりにしても、処理系によって意味合いが違うのがいいですね。<br/>
(Java とかの Thread#yield があったけど、大まか iolang のような意味合いだったよーな)</p>

<h1>io でも Generator (actor)</h1>

<p>さて、ここまで出来たのですが、 python の generator のように、外部イテレータ側に値を返したいです<br/>
そんなとき便利な actor<feature></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">generator</span> <span class="o">:=</span> <span class="k">method</span><span class="o">(</span>
</span><span class='line'>  <span class="n">counter</span> <span class="o">:=</span> <span class="mf">0</span>
</span><span class='line'>  <span class="n">block</span><span class="o">(</span>
</span><span class='line'>    <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mf">1</span>
</span><span class='line'>  <span class="o">)</span>
</span><span class='line'><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">foo</span> <span class="o">:=</span> <span class="n">generator</span>
</span><span class='line'><span class="n">val_1</span> <span class="o">:=</span> <span class="n">foo</span> <span class="o">@</span><span class="n">call</span>
</span><span class='line'><span class="n">val_2</span> <span class="o">:=</span> <span class="n">foo</span> <span class="o">@</span><span class="n">call</span>
</span><span class='line'>
</span><span class='line'><span class="n">val_1</span> <span class="n">println</span> <span class="c1">// =&gt; 1</span>
</span><span class='line'><span class="n">val_2</span> <span class="n">println</span> <span class="c1">// =&gt; 2</span>
</span></code></pre></td></tr></table></div></figure>


<p>とりあえず、これで動きそう。もはや yield どこ行ったって感じだけど。<br/>
promise でもできそうです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">generator2</span> <span class="o">:=</span> <span class="k">method</span><span class="o">(</span><span class="n">next</span><span class="o">,</span>
</span><span class='line'>  <span class="n">counter</span> <span class="o">:=</span> <span class="mf">0</span>
</span><span class='line'>  <span class="n">block</span> <span class="o">(</span>
</span><span class='line'>    <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mf">1</span>
</span><span class='line'>    <span class="n">next</span><span class="o">(</span><span class="n">counter</span><span class="o">)</span>
</span><span class='line'>  <span class="o">)</span>
</span><span class='line'><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">foo</span> <span class="o">:=</span> <span class="n">generator2</span><span class="o">(</span><span class="k">method</span><span class="o">(</span><span class="n">v</span><span class="o">,</span> <span class="n">v</span> <span class="n">println</span><span class="o">))</span>
</span><span class='line'><span class="n">foo</span> <span class="o">@@</span><span class="n">call</span>
</span><span class='line'><span class="n">yield</span>
</span><span class='line'><span class="n">foo</span> <span class="o">@@</span><span class="n">call</span>
</span><span class='line'><span class="n">yield</span>
</span></code></pre></td></tr></table></div></figure>


<p>ここで yield 使ってるので、 <code>@@</code> で呼び出したコルーチンを呼び戻すため<br/>
ということで、ここまで</p>
</div>
  
  <footer style="text-align: right">
    <a rel="full-article" href="/blog/2012/09/16/io-lang-yielding.html">permalink</a>
  </footer>


    </article>
  
  
    <article class="hentry" role="article">
      
  <header>
    
      <h1 class="entry-title">Io Scope #1</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-05T00:10:00+09:00" pubdate data-updated="true">Jun 5<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今回は <del>jsxについて</del> ではなく、iolanguage の block と scope まわりについて少し</p>

<p>javascript の closure ってとても可読性が高くて、よくあるサンプルならこんな感じ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">createCounter</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="kd">function</span> <span class="p">(){</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">createCounter</span><span class="p">();</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">());</span> <span class="c1">// =&gt; 0</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">());</span> <span class="c1">// =&gt; 1</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">createCounter</span><span class="p">();</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">b</span><span class="p">());</span> <span class="c1">// =&gt; 0</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">b</span><span class="p">());</span> <span class="c1">// =&gt; 1</span>
</span></code></pre></td></tr></table></div></figure>


<p>んで、これを io でやろうとする場合、そのままやるならこんな実装になる</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">createCounter</span> <span class="o">:=</span> <span class="k">method</span> <span class="o">(</span>
</span><span class='line'>  <span class="n">count</span> <span class="o">:=</span> <span class="mf">0</span><span class="o">;</span>
</span><span class='line'>  <span class="n">block</span> <span class="o">(</span> <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mf">1</span> <span class="o">)</span>
</span><span class='line'><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">a</span> <span class="o">:=</span> <span class="n">createCounter</span>
</span><span class='line'><span class="n">a</span> <span class="n">call</span> <span class="n">println</span> <span class="o">=&gt;</span> <span class="mf">1</span>
</span><span class='line'><span class="n">a</span> <span class="n">call</span> <span class="n">println</span> <span class="o">=&gt;</span> <span class="mf">2</span>
</span></code></pre></td></tr></table></div></figure>


<p>と、method や block が入り組んだ、とても気持ち悪いコードになってしまう。<br/>
ただ、これはなんてことはない、javascriptのブロックがfunctionになっているから、綺麗なコードに見えるだけだ！(とかいう)<br/>
ちなみに、このコードを下記のように method だけにすると、スコープの参照が出来なくなってしまう</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">createCounter</span> <span class="o">:=</span> <span class="k">method</span> <span class="o">(</span>
</span><span class='line'>  <span class="n">count</span> <span class="o">:=</span> <span class="mf">0</span><span class="o">;</span>
</span><span class='line'>  <span class="k">method</span> <span class="o">(</span> <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mf">1</span> <span class="o">)</span>
</span><span class='line'><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">b</span> <span class="o">:=</span> <span class="n">createCounter</span>
</span><span class='line'><span class="n">b</span> <span class="n">println</span> <span class="o">=&gt;</span> <span class="n">Exception</span><span class="err">:</span> <span class="n">Object</span> <span class="n">does</span> <span class="n">not</span> <span class="n">respond</span> <span class="n">to</span> <span class="err">&#39;</span><span class="n">count</span><span class="err">&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>つまり、<code>method</code> は内包的なブロックを参照できないけど <code>block</code> は参照できる。と<br/>
んで、これを使うと <code>interpolate</code> がひと味違ってくる</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">a</span> <span class="o">:=</span> <span class="n">block</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span>
</span><span class='line'>  <span class="s">&quot;hello #{a} #{b + c}&quot;</span> <span class="n">interpolate</span>
</span><span class='line'><span class="o">)</span>
</span><span class='line'><span class="n">a</span> <span class="n">call</span><span class="o">(</span><span class="s">&quot;hello world&quot;</span><span class="o">,</span> <span class="mf">1</span><span class="o">,</span> <span class="mf">2</span><span class="o">)</span> <span class="c1">// =&gt; hello hello world 3</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>interpolate</code> は通常こんな使い方になってしまうんだけど、block はスコープを参照してるのがいいね</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">obj</span> <span class="o">:=</span> <span class="n">Object</span> <span class="k">clone</span>
</span><span class='line'><span class="n">obj</span> <span class="n">a</span> <span class="o">:=</span> <span class="s">&quot;hello world&quot;</span>
</span><span class='line'><span class="n">obj</span> <span class="n">b</span> <span class="o">:=</span> <span class="mf">1</span>
</span><span class='line'><span class="n">obj</span> <span class="n">c</span> <span class="o">:=</span> <span class="mf">2</span>
</span><span class='line'><span class="s">&quot;hello #{a} #{b + c}&quot;</span> <span class="n">interpolate</span><span class="o">(</span><span class="n">obj</span><span class="o">)</span> <span class="c1">// hello hello world 3</span>
</span></code></pre></td></tr></table></div></figure>


<p>さて、何を書こうと思ってたか忘れてしまった。。。<br/>
<code>block</code> とかその辺りは次回へ続く。。。</p>
</div>
  
  <footer style="text-align: right">
    <a rel="full-article" href="/blog/2012/06/05/io-lang-scope-1.html">permalink</a>
  </footer>


    </article>
  
  
    <article class="hentry" role="article">
      
  <header>
    
      <h1 class="entry-title">Io Language Assignment Code</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-18T00:51:00+09:00" pubdate data-updated="true">May 18<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今日は気分転換に io の話題でも<br/>
io-lang には3種類くらいの assignment statement(というか expressionかな)があるんだけど、<br/>
どれも使い方がよくわからん、と最初につまづくことかと思います。</p>

<p>代入式としては、以下の3つです</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">hoge</span> <span class="o">:=</span> <span class="s">&quot;set value&quot;</span>
</span><span class='line'><span class="n">hoge</span> <span class="o">=</span> <span class="s">&quot;update value&quot;</span>
</span><span class='line'><span class="n">hoge</span> <span class="o">::=</span> <span class="s">&quot;new value&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>と、これらはそれぞれ、以下のように動作します</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">Lobby</span> <span class="n">setSlot</span><span class="o">(</span><span class="s">&quot;hoge&quot;</span><span class="o">,</span> <span class="s">&quot;set slot&quot;</span><span class="o">)</span>
</span><span class='line'><span class="n">hoge</span> <span class="n">println</span> <span class="c1">// =&gt; &quot;set slot&quot;</span>
</span><span class='line'><span class="n">Lobby</span> <span class="n">updateSlot</span><span class="o">(</span><span class="s">&quot;hoge&quot;</span><span class="o">,</span> <span class="s">&quot;update value&quot;</span><span class="o">)</span>
</span><span class='line'><span class="n">hoge</span> <span class="n">println</span> <span class="c1">// =&gt; &quot;update value&quot;</span>
</span><span class='line'><span class="n">Lobby</span> <span class="n">newSlot</span><span class="o">(</span><span class="s">&quot;hoge&quot;</span><span class="o">,</span> <span class="s">&quot;new value&quot;</span><span class="o">)</span>
</span><span class='line'><span class="n">hoge</span> <span class="n">println</span> <span class="c1">// =&gt; &quot;new value&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>んで、<code>::=</code> である、newSlot は setter を生成してくれるメソッドになります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">hoge</span> <span class="o">:=</span> <span class="n">Object</span> <span class="k">clone</span>
</span><span class='line'><span class="n">hoge</span> <span class="n">foo</span> <span class="o">::=</span> <span class="mf">123</span>
</span><span class='line'><span class="n">hoge</span> <span class="n">setFoo</span><span class="o">(</span><span class="mf">456</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>こんな感じ。<br/>
今回は、この <code>::=</code> の動作まわりではなく、<code>:=</code> と <code>=</code> についての話題です。<br/>
まずは、下記のコードをみてください</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">x</span> <span class="o">:=</span> <span class="mf">10</span>
</span><span class='line'>
</span><span class='line'><span class="n">hoge</span> <span class="o">:=</span> <span class="k">method</span><span class="o">(</span>
</span><span class='line'>  <span class="n">x</span> <span class="o">=</span> <span class="mf">123</span>
</span><span class='line'>  <span class="o">(</span><span class="s">&quot;hoge x is &quot;</span> <span class="o">..</span> <span class="n">x</span><span class="o">)</span> <span class="n">println</span>
</span><span class='line'><span class="o">)</span>
</span><span class='line'><span class="n">foo</span> <span class="o">:=</span> <span class="k">method</span><span class="o">(</span>
</span><span class='line'>  <span class="n">x</span> <span class="o">:=</span> <span class="mf">456</span>
</span><span class='line'>  <span class="o">(</span><span class="s">&quot;foo x is &quot;</span> <span class="o">..</span> <span class="n">x</span><span class="o">)</span> <span class="n">println</span>
</span><span class='line'><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">hoge</span>
</span><span class='line'><span class="o">(</span><span class="s">&quot;1) x is &quot;</span> <span class="o">..</span> <span class="n">x</span><span class="o">)</span> <span class="n">println</span>
</span><span class='line'>
</span><span class='line'><span class="n">foo</span>
</span><span class='line'><span class="o">(</span><span class="s">&quot;2) x is &quot;</span> <span class="o">..</span> <span class="n">x</span><span class="o">)</span> <span class="n">println</span>
</span></code></pre></td></tr></table></div></figure>


<p>これの結果はどうなるでしょうか。<br/>
すべての x の出力は hoge メソッドで設定された 123 になるでしょうか。<br/>
それともスコープ上 一番上にある 10 のままになるでしょうか。</p>

<p>結果はこんな感じになります</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='io'><span class='line'><span class="n">hoge</span> <span class="n">x</span> <span class="n">is</span> <span class="mf">123</span>
</span><span class='line'><span class="mf">1</span><span class="o">)</span> <span class="n">x</span> <span class="n">is</span> <span class="mf">123</span>
</span><span class='line'><span class="n">foo</span> <span class="n">x</span> <span class="n">is</span> <span class="mf">456</span>
</span><span class='line'><span class="mf">2</span><span class="o">)</span> <span class="n">x</span> <span class="n">is</span> <span class="mf">123</span>
</span></code></pre></td></tr></table></div></figure>


<p>なんと、hoge メソッドで上書きした(updateSlot)値は foo メソッドで上書きされていない(setSlot)のです<br/>
少し不思議な動きな感じもします。</p>

<p>ただ、これも javascript で考えると案外フツーなことだったりします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">hoge</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(){</span>
</span><span class='line'>  <span class="nx">x</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hoge x is &quot;</span> <span class="o">+</span> <span class="nx">x</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">456</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;foo x is &quot;</span> <span class="o">+</span> <span class="nx">x</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">hoge</span><span class="p">();</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;1) x is &quot;</span> <span class="o">+</span> <span class="nx">x</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">foo</span><span class="p">();</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;2) x is &quot;</span> <span class="o">+</span> <span class="nx">x</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>このjsのコードもioの結果と同じになります。</p>

<p>なんとなく、ioでもレキシカルスコープみたいのがあるんだなーと思うと夢が広がりングですね。
ちなみに、この話題は最近投稿された↓のトピックから参照してます。<br/>
<a href="http://tech.groups.yahoo.com/group/iolanguage/message/13177">iolanguage : Message: Re: [Io] Assignment Operators</a></p>

<p>その内、どこかで block と interpolate などについても話題にしたいところ。</p>
</div>
  
  <footer style="text-align: right">
    <a rel="full-article" href="/blog/2012/05/18/io-lang-assignment.html">permalink</a>
  </footer>


    </article>
  
  
    <article class="hentry" role="article">
      
  <header>
    
      <h1 class="entry-title">My First Perl#5</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-22T22:09:00+09:00" pubdate data-updated="true">Apr 22<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>さて、期間があいてしまいました。<br/>
クラス系をやっていたけど、少し脱線して、関数プログラミング的なものを少しやってました。<br/>
理解を深めるために、今回もjavascriptのコードを含めます。</p>

<h2>高階関数</h2>

<p>perlでも高階関数(関数を引数に受け取れる関数)を扱えるらしい。<br/>
記述としてはこんな感じ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">hoge</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="p">(</span><span class="nv">$foo</span><span class="p">,</span> <span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="o">&amp;</span><span class="nv">$foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="n">hoge</span><span class="p">(</span><span class="k">sub </span><span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="nv">$x</span> <span class="o">+</span> <span class="nv">$y</span><span class="p">;</span>
</span><span class='line'><span class="p">},</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>これは javascript に置き換えるとこんな感じになる</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">hoge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">foo</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">){</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">foo</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">hoge</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">){</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="p">;</span>
</span><span class='line'><span class="p">},</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>幾分(というか、かなり)の部分で javascript の方が可読性が高いけど、<br/>
関数hogeは、第一引数に高階関数と引数a, b受け取る関数になる、<br/>
高階関数の実装は、与えられた引数x, yを加算するだけ、というシンプルなもの</p>

<p>perl のコードだと、&amp;$foo となっているけど、$foo に入っているコードや文字列の実行に当たるらしい。<br/>
これに関しては以下になる</p>

<h3>変数に与えられた関数の実行</h3>

<p>変数に割り当てられた変数の実行は、こんな感じでできるらしい(ただし、&#8221;strict refs&#8221;になる)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">sub </span><span class="nf">hoge</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$arg1</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">print</span> <span class="s">&quot;arg1 =&gt; $arg1 \n&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">$variable</span> <span class="o">=</span> <span class="s">&quot;hoge&quot;</span><span class="p">;</span>
</span><span class='line'><span class="o">&amp;</span><span class="p">{</span><span class="nv">$variable</span><span class="p">}(</span><span class="s">&quot;hello world&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>これにより、変数$variableに割り当てられた値の実行は &amp;$variable で行うらしい</p>

<h2>カリー化</h2>

<p>高階関数ができるなら、やっぱり使えて欲しいカリー化(currying)<br/>
カレーじゃない方で</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">currying</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="p">(</span><span class="nv">$target</span><span class="p">,</span> <span class="nv">$arg1</span><span class="p">,</span> <span class="nv">$arg2</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="k">sub </span><span class="p">{</span>
</span><span class='line'>    <span class="k">my</span> <span class="nv">$arg3</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="o">&amp;</span><span class="nv">$target</span><span class="p">(</span><span class="nv">$arg1</span><span class="p">,</span> <span class="nv">$arg2</span><span class="p">,</span> <span class="nv">$arg3</span><span class="p">);</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">$calc</span> <span class="o">=</span> <span class="k">sub </span><span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">*</span> <span class="nv">$c</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">$c1</span> <span class="o">=</span> <span class="n">currying</span><span class="p">(</span><span class="nv">$calc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'><span class="k">print</span> <span class="o">&amp;</span><span class="nv">$c1</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1"># ==&gt; 9</span>
</span><span class='line'><span class="k">print</span> <span class="o">&amp;</span><span class="nv">$c1</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1"># ==&gt; 12</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">$c2</span> <span class="o">=</span> <span class="n">currying</span><span class="p">(</span><span class="nv">$calc</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span><span class='line'><span class="k">print</span> <span class="o">&amp;</span><span class="nv">$c2</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1"># ==&gt; 21</span>
</span><span class='line'><span class="k">print</span> <span class="o">&amp;</span><span class="nv">$c2</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1"># ==&gt; 28</span>
</span></code></pre></td></tr></table></div></figure>


<p>関数を返却されたことがわかっていれば、&amp;$variable() で関数を実行できるらしい<br/>
これにより、引数束縛(curry)ができると。<br/>
少し、&amp;$var が気持ち悪いけど。</p>

<p>これまた、js で書きなおすとこんな感じ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">currying</span>  <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">){</span>
</span><span class='line'>  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg3</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">target</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="nx">arg3</span><span class="p">);</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">calc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">)</span> <span class="o">*</span> <span class="nx">c</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">c1</span> <span class="o">=</span> <span class="nx">currying</span><span class="p">(</span><span class="nx">calc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">c1</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span> <span class="c1">// ==&gt; 9</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">c1</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span> <span class="c1">// ==&gt; 12</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">c2</span> <span class="o">=</span> <span class="nx">currying</span><span class="p">(</span><span class="nx">calc</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">c2</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span> <span class="c1">// ==&gt; 21</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">c2</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span> <span class="c1">// ==&gt; 28</span>
</span></code></pre></td></tr></table></div></figure>


<h2>クロージャの生成</h2>

<p>少し戻り、クロージャの生成とその実行<br/>
高階関数ができるなら、やっぱり使えて欲しいクロージャ<br/>
やってみた。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">closure</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="k">sub </span><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nv">$counter</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">$c1</span> <span class="o">=</span> <span class="n">closure</span><span class="p">();</span>
</span><span class='line'><span class="k">print</span> <span class="o">&amp;</span><span class="nv">$c1</span><span class="p">();</span> <span class="c1"># ==&gt; 0</span>
</span><span class='line'><span class="k">print</span> <span class="o">&amp;</span><span class="nv">$c1</span><span class="p">();</span> <span class="c1"># ==&gt; 1</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">$c2</span> <span class="o">=</span> <span class="n">closure</span><span class="p">();</span>
</span><span class='line'><span class="k">print</span> <span class="o">&amp;</span><span class="nv">$c2</span><span class="p">();</span> <span class="c1"># ==&gt; 0</span>
</span><span class='line'><span class="k">print</span> <span class="o">&amp;</span><span class="nv">$c2</span><span class="p">();</span> <span class="c1"># ==&gt; 1</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># c1 </span>
</span><span class='line'><span class="k">print</span> <span class="o">&amp;</span><span class="nv">$c1</span><span class="p">();</span> <span class="c1"># ==&gt; 2</span>
</span></code></pre></td></tr></table></div></figure>


<p>かなり素直に実行できます。</p>

<h1>今回はここまで</h1>

<p>次回は、リファクタリングで使える ::can とか使って<br/>
パッケージ単位で関数プログラミングです。</p>

<p>人はそれをメタプログラミングというらしいけど、関数言語だと結構頻繁に使えて便利なので<br/>
次回はそこにハマった人の内容になる。かも。</p>
</div>
  
  <footer style="text-align: right">
    <a rel="full-article" href="/blog/2012/04/22/my-first-perl-5.html">permalink</a>
  </footer>


    </article>
  
  
    <article class="hentry" role="article">
      
  <header>
    
      <h1 class="entry-title">My First Perl #4</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-01T21:15:00+09:00" pubdate data-updated="true">Apr 1<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>クラス編</h1>

<p>ということで、クラス。<br/>
Classで重要なのはやっぱり継承パターンと多態性でしょう。<br/>
アクセサはどうなってるのか、パッケージとかも含め、それくらいできると夢が広がりングな気がする</p>

<p>参考にはいつもの <a href="http://d.hatena.ne.jp/perlcodesample/20100513/1276960096">オブジェクト指向 / Perl逆引き事典 - サンプルコードによるPerl入門</a> を 見てます。</p>

<h2>クラス作成</h2>

<p>package が使えるそうな。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">package</span> <span class="n">Hoge</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">new</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$proto</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">bless</span> <span class="nv">$self</span><span class="p">,</span> <span class="nv">$proto</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$hoge</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">hoge</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$hoge</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="nv">$self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">$hoge</span> <span class="o">=</span> <span class="n">Hoge</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span><span class="s">&#39;hello world&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">print</span> <span class="nv">$hoge</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">hoge</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>コンストラクタの定義から、プロパティの設定と取得はこうやるのね。<br/>
元のページ → <a href="http://d.hatena.ne.jp/perlcodesample/20090320/1237130107">汎用的なコンストラクタの雛形 - サンプルコードによるPerl入門</a> には init メソッドが必要とのことだったけど、今回は無視<br/>
どうやら、new のコンストラクタには <code>[Class(prototype), arg1, arg2..]</code> といった形式で渡されているようですね<br/>
bless がよくわからないけど、js でいうところの Function.prototype.bind 的なものだろうか、第一引数に prototype を割り当てる的な(それだとapplyの方が近そうだけど)</p>

<h2>プロパティ作成</h2>

<p>もう少し、プロパティ<br/>
参考元を参考に、引数を色々受け取ってみる</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">package</span> <span class="n">Hoge</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">new</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$proto</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">bless</span> <span class="nv">$self</span><span class="p">,</span> <span class="nv">$proto</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nv">$self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">init</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="p">(</span><span class="nv">$self</span><span class="p">,</span> <span class="p">(</span><span class="nv">$hoge</span><span class="p">,</span> <span class="nv">$foo</span><span class="p">,</span> <span class="nv">$bar</span><span class="p">))</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">hoge</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$hoge</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">foo</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$foo</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">bar</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$bar</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">$hoge</span> <span class="o">=</span> <span class="n">Hoge</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;world&#39;</span><span class="p">,</span> <span class="s">&#39;perl #4&#39;</span><span class="p">);</span>
</span><span class='line'><span class="c1"># print $hoge-&gt;hoge . &#39;:&#39; . $hoge-&gt;foo . &#39;:&#39; . $hoge-&gt;bar . &quot;\n&quot;;</span>
</span><span class='line'><span class="c1">## =&gt; Can&#39;t locate object method &quot;hoge&quot; via package &quot;Hoge&quot;</span>
</span><span class='line'><span class="k">print</span> <span class="nv">$hoge</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">hoge</span><span class="p">}</span> <span class="o">.</span> <span class="s">&#39;:&#39;</span> <span class="o">.</span> <span class="nv">$hoge</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">foo</span><span class="p">}</span> <span class="o">.</span> <span class="s">&#39;:&#39;</span> <span class="o">.</span> <span class="nv">$hoge</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">bar</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>なるほど、<code>$self-&gt;{verialble}</code> で設定したものは、<code>$self-&gt;variable</code>で取り出せないのね(Hashだから?)。当たり前といえば当たり前だった。<br/>
それ以外は意外とフツーな感じ</p>

<h2>メソッド作成</h2>

<p>プロパティまでは作成できたので、次はメソッド。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">package</span> <span class="n">Hoge</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">new</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$proto</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">bless</span> <span class="nv">$self</span><span class="p">,</span> <span class="nv">$proto</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nv">$self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">init</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="p">(</span><span class="nv">$self</span><span class="p">,</span> <span class="p">(</span><span class="nv">$hoge</span><span class="p">,</span> <span class="nv">$foo</span><span class="p">,</span> <span class="nv">$bar</span><span class="p">))</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">hoge</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$hoge</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">foo</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$foo</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">bar</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$bar</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">greeting</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">hoge</span><span class="p">}</span> <span class="o">.</span> <span class="s">&#39;:&#39;</span> <span class="o">.</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">foo</span><span class="p">}</span> <span class="o">.</span> <span class="s">&#39;:&#39;</span> <span class="o">.</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">bar</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">$hoge</span> <span class="o">=</span> <span class="n">Hoge</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;world&#39;</span><span class="p">,</span> <span class="s">&#39;perl #4&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$hoge</span><span class="o">-&gt;</span><span class="n">greeting</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>先ほどの property で出力してたのを メソッドで。<br/>
第一引数に <code>self(自分自身)</code> が入ってるとか、python ぽい</p>

<h3>メソッド引数</h3>

<p>メソッドのプロパティはどうなってるのか。<br/>
たぶん、<code>#init</code> で試したから同じだと思うけど。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">package</span> <span class="n">Hoge</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">new</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$proto</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">bless</span> <span class="nv">$self</span><span class="p">,</span> <span class="nv">$proto</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nv">$self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">init</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="p">(</span><span class="nv">$self</span><span class="p">,</span> <span class="p">(</span><span class="nv">$hoge</span><span class="p">,</span> <span class="nv">$foo</span><span class="p">,</span> <span class="nv">$bar</span><span class="p">))</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">hoge</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$hoge</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">foo</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$foo</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">bar</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$bar</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">greeting</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>  <span class="k">my</span> <span class="p">(</span><span class="nv">$arg1</span><span class="p">,</span> <span class="nv">$arg2</span><span class="p">,</span> <span class="nv">$arg3</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">hoge</span><span class="p">}</span> <span class="o">.</span> <span class="s">&#39;:&#39;</span> <span class="o">.</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">foo</span><span class="p">}</span> <span class="o">.</span> <span class="s">&#39;:&#39;</span> <span class="o">.</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">bar</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$arg1</span> <span class="o">.</span> <span class="s">&#39;,&#39;</span> <span class="o">.</span> <span class="nv">$arg2</span> <span class="o">.</span> <span class="s">&#39;,&#39;</span> <span class="o">.</span> <span class="nv">$arg3</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">$hoge</span> <span class="o">=</span> <span class="n">Hoge</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;world&#39;</span><span class="p">,</span> <span class="s">&#39;perl #4&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$hoge</span><span class="o">-&gt;</span><span class="n">greeting</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>ふむ。<br/>
shift は <code>@_</code> から一つ shift して、 <code>@_</code> 自体は <code>(a, b) = @_</code> とかのリスト構文的なので、値をまとめて代入できる。と</p>

<h2>継承</h2>

<p>クラスの継承。なんかちょっと特殊だった</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">package</span> <span class="n">Hoge</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">new</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$proto</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">bless</span> <span class="nv">$self</span><span class="p">,</span> <span class="nv">$proto</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nv">$self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">init</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="p">(</span><span class="nv">$self</span><span class="p">,</span> <span class="p">(</span><span class="nv">$hoge</span><span class="p">,</span> <span class="nv">$foo</span><span class="p">,</span> <span class="nv">$bar</span><span class="p">))</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">hoge</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$hoge</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">foo</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$foo</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">bar</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$bar</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">greeting</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>  <span class="k">my</span> <span class="p">(</span><span class="nv">$arg1</span><span class="p">,</span> <span class="nv">$arg2</span><span class="p">,</span> <span class="nv">$arg3</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">hoge</span><span class="p">}</span> <span class="o">.</span> <span class="s">&#39;:&#39;</span> <span class="o">.</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">foo</span><span class="p">}</span> <span class="o">.</span> <span class="s">&#39;:&#39;</span> <span class="o">.</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">bar</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$arg1</span> <span class="o">.</span> <span class="s">&#39;,&#39;</span> <span class="o">.</span> <span class="nv">$arg2</span> <span class="o">.</span> <span class="s">&#39;,&#39;</span> <span class="o">.</span> <span class="nv">$arg3</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nb">package</span> <span class="n">Foo</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">base</span><span class="p">(</span><span class="s">&#39;Hoge&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">new</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$proto</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">bless</span> <span class="nv">$self</span><span class="p">,</span> <span class="nv">$proto</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nv">$self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">greeting</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">print</span> <span class="s">&#39;Im Foo#&#39;</span> <span class="o">.</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">hoge</span><span class="p">}</span> <span class="o">.</span> <span class="s">&#39;,&#39;</span> <span class="o">.</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">foo</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">$foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;world&#39;</span><span class="p">,</span> <span class="s">&#39;perl #4&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$foo</span><span class="o">-&gt;</span><span class="n">greeting</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>まず、</p>

<ul>
<li><code>@ISA</code> はよくわからなかったので、<code>use base</code>による継承を使った。</li>
<li><code>super</code> を指定しないでも上位メソッドはコンストラクタから呼べた</li>
<li><code>new</code> のコンストラクタには、上位クラスの参照はなかった</li>
<li>override 記述をしなくても、自動的に override だった。</li>
<li>上位プロパティは特に指定なしに呼び出せた。</li>
</ul>


<p>これ、use で複数とか指定するとどうなっちゃうんだろ。差分継承だったらいいな。(それはいつかやる)</p>

<h3>overrideしたメソッドから上位メソッドの呼び出し</h3>

<p>疑問に思ったのでこれをやってみる<br/>
この方法は、<a href="http://d.hatena.ne.jp/BigFatCat/20071215/1197701541">ここから</a> 参照。<br/>
ちなみに、やらんとしてることは、javascript だとこんな感じ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">Hoge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="nx">Hoge</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">greeting</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Im Hoge: &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">Foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">Hoge</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="nx">Foo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">greeting</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bar</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">Hoge</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">greeting</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;bar value =&gt; &#39;</span> <span class="o">+</span> <span class="nx">bar</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">foo</span><span class="p">.</span><span class="nx">greeting</span><span class="p">(</span><span class="s1">&#39;**bar value**&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>ということで、perl</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">package</span> <span class="n">Hoge</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">new</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$proto</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">bless</span> <span class="nv">$self</span><span class="p">,</span> <span class="nv">$proto</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nv">$self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">init</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="p">(</span><span class="nv">$self</span><span class="p">,</span> <span class="p">(</span><span class="nv">$hoge</span><span class="p">,</span> <span class="nv">$foo</span><span class="p">,</span> <span class="nv">$bar</span><span class="p">))</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">hoge</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$hoge</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">foo</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$foo</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">bar</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$bar</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">greeting</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>  <span class="k">my</span> <span class="p">(</span><span class="nv">$arg1</span><span class="p">,</span> <span class="nv">$arg2</span><span class="p">,</span> <span class="nv">$arg3</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">hoge</span><span class="p">}</span> <span class="o">.</span> <span class="s">&#39;:&#39;</span> <span class="o">.</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">foo</span><span class="p">}</span> <span class="o">.</span> <span class="s">&#39;:&#39;</span> <span class="o">.</span> <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">bar</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$arg1</span> <span class="o">.</span> <span class="s">&#39;,&#39;</span> <span class="o">.</span> <span class="nv">$arg2</span> <span class="o">.</span> <span class="s">&#39;,&#39;</span> <span class="o">.</span> <span class="nv">$arg3</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nb">package</span> <span class="n">Foo</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">base</span><span class="p">(</span><span class="s">&#39;Hoge&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">new</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$proto</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">bless</span> <span class="nv">$self</span><span class="p">,</span> <span class="nv">$proto</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nv">$self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">greeting</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$self</span><span class="o">-&gt;</span><span class="nn">SUPER::</span><span class="n">greeting</span><span class="p">(</span><span class="s">&#39;Im&#39;</span><span class="p">,</span> <span class="s">&#39;Foo&#39;</span><span class="p">,</span> <span class="s">&#39;#greeting&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">$foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;world&#39;</span><span class="p">,</span> <span class="s">&#39;perl #4&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$foo</span><span class="o">-&gt;</span><span class="n">greeting</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>なるほど。<code>$self-&gt;SUPER::#method</code> で上位メソッド(というか親インスタンスのメソッドの呼び出し)ができるようになるのね。<br/>
これは使い道が広がるわ。</p>

<h1>次回</h1>

<p>アクセサを見てみたいところだけど、やっぱここで触れなかった package あたり。
どうやって分割してんのかと。</p>
</div>
  
  <footer style="text-align: right">
    <a rel="full-article" href="/blog/2012/04/01/my-first-perl-4.html">permalink</a>
  </footer>


    </article>
  
  
    <article class="hentry" role="article">
      
  <header>
    
      <h1 class="entry-title">My First Perl #3</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-30T19:43:00+09:00" pubdate data-updated="true">Mar 30<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ということ(?)で、関数とクラスあたりのステップに行こうと思う</p>

<h1>関数</h1>

<p>関数は sub を使う。と<br/>
しかも sub が sub たる理由はサブルーチン。なるほど。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">hoge</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$arg1</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$arg1</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">hoge</span><span class="p">(</span><span class="s">&#39;hello world&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>shift に引数はないけど、引数を先頭から取得するときに使うらしい。<br/>
少し謎。<br/>
<strong><em>どうやら <code>shift</code> の引数なしは <code>shift @_</code> と同義らしい <a href="http://d.hatena.ne.jp/perlcodesample/20101130/1298764341">http://d.hatena.ne.jp/perlcodesample/20101130/1298764341</a></em></strong></p>

<p>もう少し引数を受け取りましょう。<br/>
構造体Hashとか</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#my %hoge = (a =&gt; 1, b =&gt; 2);</span>
</span><span class='line'><span class="c1"># HashをHashとして出力するときは %hash なのね。。</span>
</span><span class='line'><span class="c1">#print %hoge . &quot;\n&quot;;</span>
</span><span class='line'><span class="c1"># でもkeyの値を出すときは $hash なのね。。</span>
</span><span class='line'><span class="c1">#print $hoge{a} . &quot;\n&quot;;</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">foo</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$value_1</span> <span class="o">=</span> <span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$value_1</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="c1"># ==&gt; a と出る</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$value_2</span> <span class="o">=</span> <span class="nb">ref</span> <span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$value_2</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="c1"># ==&gt; 何もでない</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">my</span> <span class="nv">$value_3</span> <span class="o">=</span> <span class="nb">ref</span> <span class="p">{</span><span class="nv">@_</span><span class="p">};</span>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$value_3</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="c1"># ==&gt; Hash と出る...ということはこれでHashを受け取れたハズ。</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#print $value_3{a} . &quot;\n&quot;;</span>
</span><span class='line'>  <span class="c1"># ==&gt; &#39;Global symbol &quot;%value_3&quot; requires explicit package&#39; えええええ！</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#my %value_4 = ref {@_};</span>
</span><span class='line'>  <span class="c1">#print $value_4{a} . &quot;\n&quot;;</span>
</span><span class='line'>  <span class="c1"># ==&gt; &#39;Odd number of elements in hash assignment&#39; えええええええええ！！</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># 素直に。。</span>
</span><span class='line'>  <span class="k">my</span> <span class="nv">%value_5</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$value_5</span><span class="p">{</span><span class="n">a</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$value_5</span><span class="p">{</span><span class="n">b</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">foo</span><span class="p">((</span><span class="n">a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>最初に <a href="http://d.hatena.ne.jp/perlcodesample/20101130/1298764341">http://d.hatena.ne.jp/perlcodesample/20101130/1298764341</a> を読んだのがマズかったか。。。<br/>
やっぱりサンプルコードがあるほうがいいよね。<br/>
というっことで、 $value_(1..4) あでは、上記の記事をナナメ読みして頑張った結果。<br/>
$value_5 というフツーな方法で大丈夫だと知ったのは <a href="http://d.hatena.ne.jp/perlcodesample/20080605/1212675666">http://d.hatena.ne.jp/perlcodesample/20080605/1212675666</a> の記事を読んでから。。</p>

<p><strong><em>正直 $value_3{a} と $value_4{a} がエラーになる理由が全然少しもわからん</em></strong><br/>
構文から学ぶべきだった。。。</p>

<p>perl って、%だったり $とか @とか タイヘンです。。</p>

<p>今回は sub 、もといサブルーチンに衝撃を受けたので、次回にでもクラスをやろう。。</p>
</div>
  
  <footer style="text-align: right">
    <a rel="full-article" href="/blog/2012/03/30/my-first-perl-3.html">permalink</a>
  </footer>


    </article>
  
  
    <article class="hentry" role="article">
      
  <header>
    
      <h1 class="entry-title">Node.jsでコンソールにBad Apple!!を出力してみた</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-29T23:56:00+09:00" pubdate data-updated="true">Mar 29<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.nicovideo.jp/watch/sm8628149">【東方】Bad Apple!!　ＰＶ【影絵】</a> というニコニコ動画で人気の動画があるんだけど、これをコンソールに出してみよう。と思ってやってみた。</p>

<iframe width="312" height="176" src="http://ext.nicovideo.jp/thumb/sm17397285" scrolling="no" style="border:solid 1px #CCC;" frameborder="0"><a href="http://www.nicovideo.jp/watch/sm17397285">【ニコニコ動画】コンソールでBad Apple!! 影絵PV</a></iframe>


<p>元の動画はモノクロな感じなので、コンソールに出力するのは簡単かなーと思っていたんだけど<br/>
案外面倒だった。</p>

<p>まず、元の動画をBitmapイメージシーケンスに変換するのが面倒だった。
<a href="http://www.squared5.com/">MPEG Streamclip</a> っていうソフトに行き着くまでが大変だった。。。<br/>
こんな感じで白黒なBitmapの連続データに変換してます。</p>

<p><img src="http://nowelium.github.com/images/s2012-03-30.02.07.png" width="400" height="300"></p>

<p>んで、ここから連続したBitmap画像データができたので</p>

<p><img src="http://nowelium.github.com/images/s2012-03-30.19.35.png" width="400" height="300"></p>

<p>このBitmapたちをjavascriptで読めるように <a href="https://github.com/nowelium/node-bitmap">nowelium/node-bitmap</a> を作った。</p>

<p>Bitmapの読み取りは <a href="http://www.kk.iij4u.or.jp/~kondo/bmp/">bmp ファイルフォーマット</a> と <a href="http://ja.wikipedia.org/wiki/Windows_bitmap">Windows bitmap - Wikipedia</a> を参考にしてます。<br/>
Bitmapって画像データだけの塊だと思ってたら、ちゃんとした仕様があったんだね。。</p>

<p>今回の動画で使ってる実際のコードはgistに貼ってます。</p>

<div><script src='https://gist.github.com/2221106.js?file='></script>
<noscript><pre><code>var fs = require('fs');
var util = require('util');
var async = require('async');

var Bitmap = require('./bitmap');

//
// ニコニコ動画の【東方】Bad Apple!!　ＰＶ【影絵】 &lt;http://www.nicovideo.jp/watch/sm8628149&gt;
// を 30fps な bitmap に分割したので、
// それを読み込みつつ、コンソールに表示してみる。
//
// async &lt;https://github.com/caolan/async&gt;
// を使ってるので、 npm install async する
//
// youtubeにモッサリ動画を上げてみた。&lt;http://youtu.be/IALA76KSc4I&gt;
// 音付きにしてニコニコ動画に上げてみた。&lt;http://www.nicovideo.jp/watch/sm17397285&gt;
//
var imageSequenceDir = 'badapple_30fps_160_120';
fs.readdir(__dirname + '/' + imageSequenceDir, function(err, files){
  if(err){
    throw err;
  }

  var pathes = files.map(function(file){
    return __dirname + '/' + imageSequenceDir + '/' + file;
  }).filter(function(path){
    if(/\.bmp$/.test(path)){
      return true;
    }
    return false;
  });

  // コンソールに出すときに半角スペースと#の文字列に変換
  Bitmap.prototype.mapRGBA = function(r, g, b){
    if(255 == r &amp;&amp; 255 == g &amp;&amp; 255 == b){
      return '  ';
    }
    return '##';
  };

  var render = async.queue(function(view, next){
    util.print('\033[2J');
    util.print(view);
    util.print('\033[0;0H');
    return next(null);
  }, 1);

  var queue = async.queue(function(path, next){
    return fs.readFile(path, next);
  }, 8);

  var serial = [];
  queue.push(pathes, function(err, buffer){
    if(err){
      throw err;
    }

    var bitmap = new Bitmap(buffer);
    bitmap.init();
    if(!bitmap.isBitmap()){
      throw new Error('not bitmap');
    }

    serial.push(function(next){
      var values = bitmap.getData();

      var view = values.map(function(line){
        return line.join('');
      });
      return render.push(view.join('\n'), function(){
        return setTimeout(next, 22);
      });
    });  
  });
  queue.drain = function(){
    async.series(serial, function(err, results){
      if(err){
        console.error(err);
        return process.exit(1);
      }

      console.log('\033[2J'); // clear screen
      return process.exit(0);
    });
  };
});</code></pre></noscript></div>


<p>話は戻るけど、本家の <a href="http://www.nicovideo.jp/watch/sm8628149">【東方】Bad Apple!!　ＰＶ【影絵】</a> の派生動画が色々面白くて</p>

<p>僕が今回これをつくろうと思うきっかけになった、<a href="http://www.nicovideo.jp/watch/sm11328052">Japanino(arduino互換機)でBad Appleしてたり</a>、 <a href="http://www.nicovideo.jp/watch/sm13130024">USBモニタに出してたり</a>、 <a href="http://www.nicovideo.jp/watch/sm17154423">minecraftでやってたり</a>とまぁ色々挑戦するのが面白い動画になってます。</p>

<p>そして、僕がBitmapと格闘している間、世の中はPNGでWebsocketsまでやっていたのだった。。。<br/>
<a href="http://d.hatena.ne.jp/scalar/20120320/1332217029">WebSocket で PNG 画像をバイナリ転送して、JavaScript で展開して表示してみた</a><br/>
僕の実装の方はコンソールで動画が見れるよ！っていう誰得なものだから実用性が欲しい。。
ここまで実装できたし、次はsocket.ioにでも乗っけてみると面白そうだ。</p>
</div>
  
  <footer style="text-align: right">
    <a rel="full-article" href="/blog/2012/03/29/console-badapple-js.html">permalink</a>
  </footer>


    </article>
  
  
    <article class="hentry" role="article">
      
  <header>
    
      <h1 class="entry-title">My First Perl #2</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-27T15:00:00+09:00" pubdate data-updated="true">Mar 27<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>前回の続き</h2>

<p>for 文がダサいとか言いながら、配列の初期化にこんなのを使ってた。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">my</span> <span class="nv">@list</span> <span class="o">=</span> <span class="p">();</span>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="nv">$i</span><span class="p">){</span>
</span><span class='line'>  <span class="nb">push</span> <span class="nv">@list</span><span class="p">,</span> <span class="nv">$i</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>これは、perl の範囲演算子で何とかなった。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">@list</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..</span> <span class="mi">100</span><span class="p">);</span>
</span><span class='line'><span class="k">print</span> <span class="nv">$_</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span> <span class="k">for</span> <span class="nv">@list</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>ということで、fizzbuzz 書き直し</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">@list</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..</span> <span class="mi">100</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">@fizzbuzz</span> <span class="o">=</span> <span class="nb">map</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$_</span> <span class="nv">%</span> <span class="nv">3</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$_</span> <span class="nv">%</span> <span class="nv">5</span><span class="p">)){</span>
</span><span class='line'>    <span class="s">&quot;FizzBuzz&quot;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$_</span> <span class="nv">%</span> <span class="nv">3</span><span class="p">)){</span>
</span><span class='line'>    <span class="s">&quot;Fizz&quot;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$_</span> <span class="nv">%</span> <span class="nv">5</span><span class="p">)){</span>
</span><span class='line'>    <span class="s">&quot;Buzz&quot;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$_</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span> <span class="nv">@list</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="nv">$_</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span> <span class="k">for</span> <span class="nv">@fizzbuzz</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>ということは、更に短くできそう</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="nv">$_</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span> <span class="k">for</span> <span class="nb">map</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$_</span> <span class="nv">%</span> <span class="nv">3</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$_</span> <span class="nv">%</span> <span class="nv">5</span><span class="p">)){</span>
</span><span class='line'>    <span class="s">&quot;FizzBuzz&quot;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$_</span> <span class="nv">%</span> <span class="nv">3</span><span class="p">)){</span>
</span><span class='line'>    <span class="s">&quot;Fizz&quot;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$_</span> <span class="nv">%</span> <span class="nv">5</span><span class="p">)){</span>
</span><span class='line'>    <span class="s">&quot;Buzz&quot;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$_</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..</span> <span class="mi">100</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>おお。<br/>
後置 for で map が扱えるとか。ちゃんとした言語だ。<br/>
ということで、変数が <code>$_</code> だけになったのが良くなってきた感じ。</p>

<p><strong><em>FizzBuzz</em></strong> はこのくらにして、次へ</p>
</div>
  
  <footer style="text-align: right">
    <a rel="full-article" href="/blog/2012/03/27/my-first-perl-2.html">permalink</a>
  </footer>


    </article>
  
  
    <article class="hentry" role="article">
      
  <header>
    
      <h1 class="entry-title">My First Perl #1</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-27T13:59:00+09:00" pubdate data-updated="true">Mar 27<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>人生初 perl を書いていこうと思います。<br/>
頑張るぞ</p>

<p>教材は <a href="http://d.hatena.ne.jp/perlcodesample/20091221/1260183022">サンプルコードによるPerl入門</a> より</p>

<p>perl 自体は lion に入ってたものをそのまま</p>

<pre><code>&gt; perl -v

This is perl 5, version 12, subversion 3 (v5.12.3) built for darwin-thread-multi-2level
(with 2 registered patches, see perl -V for more detail)

Copyright 1987-2010, Larry Wall

Perl may be copied only under the terms of either the Artistic License or the
GNU General Public License, which may be found in the Perl 5 source kit.

Complete documentation for Perl, including FAQ lists, should be found on
this system using "man perl" or "perldoc perl".  If you have access to the
Internet, point your browser at http://www.perl.org/, the Perl Home Page.
</code></pre>

<h1>control flow</h1>

<p><a href="http://d.hatena.ne.jp/perlcodesample/20091226/1264257759">Perl基礎文法最速マスター</a> を参考にするのでスキップ</p>

<h1>fizzbuzz</h1>

<p>まずは、やっぱりこれで。<br/>
文法を読んだだけなので、エレガントさには欠ける予定</p>

<h2>ルール</h2>

<p><a href="http://d.hatena.ne.jp/keyword/FizzBuzz">http://d.hatena.ne.jp/keyword/FizzBuzz</a> より</p>

<blockquote><p>3と5の公倍数の時は、FizzBuzzとだけ回答するべき。最初の定義では、たとえば15がやってきた時「3の倍数なのでFizzと言う、5の倍数なのでBuzzと言う、3と5の公倍数なのでFizzBuzzと言う、結果、15の時はFizzBuzzFizzBuzzになる」と解釈することも可能である。</p></blockquote>

<h2>定義</h2>

<ul>
<li>カウンターを設定、0とする。</li>
<li>カウンターに1を加える。</li>
<li>カウンターが100（の他、設定した値）を超えたなら、終了する。</li>
<li>カウンターが3と5の公倍数であるならば、「FizzBuzz」を出力し、2に戻る。</li>
<li>カウンターが3の倍数であるならば、「Fizz」を出力し、2に戻る。</li>
<li>カウンターが5の倍数であるならば、「Buzz」を出力し、2に戻る。</li>
<li>カウンターの数字を出力し、2に戻る。</li>
</ul>


<h3>実装</h3>

<p>こんな感じ？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="nv">$i</span><span class="p">){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">((</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$i</span> <span class="nv">%</span> <span class="nv">3</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$i</span> <span class="nv">%</span> <span class="nv">5</span><span class="p">))){</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;FizzBuzz\n&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">elsif</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="nv">$i</span> <span class="nv">%</span> <span class="nv">3</span><span class="p">){</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;Fizz\n&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">elsif</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="nv">$i</span> <span class="nv">%</span> <span class="nv">5</span><span class="p">){</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;Buzz\n&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">print</span> <span class="nv">$i</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>うむ。正解かどうかわからん。<br/>
phpの文法は perl からパクったらしいので、古く慣れ親しんだ php でも描いてみた。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="nv">$i</span><span class="p">){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">((</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">%</span> <span class="mi">3</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">%</span> <span class="mi">5</span><span class="p">))){</span>
</span><span class='line'>    <span class="k">print</span> <span class="s2">&quot;FizzBuzz</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="nv">$i</span> <span class="o">%</span> <span class="mi">3</span><span class="p">){</span>
</span><span class='line'>    <span class="k">print</span> <span class="s2">&quot;Fizz</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="nv">$i</span> <span class="o">%</span> <span class="mi">5</span><span class="p">){</span>
</span><span class='line'>    <span class="k">print</span> <span class="s2">&quot;Buzz</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$i</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>うむ。
else区を書きたくない派(あるのか?)の一員としては、単純なループならcontinue使いたくなります。</p>

<h3>もう少し凝ってみよう</h3>

<p>やっぱり for 文はダサさが目立つので map 文(?) とか 後置文(?) を使ってみたい</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">@list</span> <span class="o">=</span> <span class="p">();</span>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="nv">$i</span><span class="p">){</span>
</span><span class='line'>  <span class="nb">push</span> <span class="nv">@list</span><span class="p">,</span> <span class="nv">$i</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">my</span> <span class="nv">@fizzbuzz</span> <span class="o">=</span> <span class="nb">map</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$_</span> <span class="nv">%</span> <span class="nv">3</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$_</span> <span class="nv">%</span> <span class="nv">5</span><span class="p">)){</span>
</span><span class='line'>    <span class="s">&quot;FizzBuzz&quot;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$_</span> <span class="nv">%</span> <span class="nv">3</span><span class="p">)){</span>
</span><span class='line'>    <span class="s">&quot;Fizz&quot;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="nv">$_</span> <span class="nv">%</span> <span class="nv">5</span><span class="p">)){</span>
</span><span class='line'>    <span class="s">&quot;Buzz&quot;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$_</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span> <span class="nv">@list</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="nv">$_</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span> <span class="k">for</span> <span class="nv">@fizzbuzz</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>配列アクセスは変数として <code>$</code> を使うけど、配列としてのアクセスは <code>@</code> を使うのね。<br/>
変数が配列なのかどうかが分かりやすいね。この言語。</p>

<p>ただ、 map の戻りを指定するのは、評価された値になるってとこがなんとも。他の式と違うんだね<br/>
あとは、map の結果は必ず配列になるハズなのに <code>my @fizzbuzz</code> って宣言するのはなんとも。。。</p>

<h1>おわり</h1>

<p>次行ってみよう</p>
</div>
  
  <footer style="text-align: right">
    <a rel="full-article" href="/blog/2012/03/27/my-first-perl-1.html">permalink</a>
  </footer>


    </article>
  

  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Archives</a>
    
  </div>

  <div class="sidebar">
    
      <section>
  <h1>About Me</h1>
  <div class="avator">
    <a href="http://about.me/nowelium">
      <img src="http://www.gravatar.com/avatar/b6b88d1ee75665cf5a7553410e979a11.png?s=140" height="64" width="64" />
      <p>Yusuke Hata</p>
    </a>
  </div>
</section>
<section>
  <h2>Tags</h2>
  <span id="tag-cloud"><a href='/blog/categories/bitmap' style='font-size: 112.0%'>Bitmap(1)</a> <a href='/blog/categories/hello-world' style='font-size: 112.0%'>Hello world(1)</a> <a href='/blog/categories/io' style='font-size: 148.0%'>Io(4)</a> <a href='/blog/categories/javascript' style='font-size: 160.0%'>Javascript(5)</a> <a href='/blog/categories/nodejs' style='font-size: 112.0%'>Nodejs(1)</a> <a href='/blog/categories/octopress' style='font-size: 124.0%'>Octopress(2)</a> <a href='/blog/categories/perl' style='font-size: 160.0%'>Perl(5)</a> <a href='/blog/categories/python' style='font-size: 112.0%'>Python(1)</a> </span>
</section>
<section>
  <h2>Recent Posts</h2>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/04/14/io-nonblocking-timer.html">Io languageでタイマー</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/16/io-lang-yielding.html">Io Language で yielding</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/05/io-lang-scope-1.html">io scope #1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/18/io-lang-assignment.html">io language assignment code</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/04/22/my-first-perl-5.html">My First Perl#5</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/04/01/my-first-perl-4.html">My First Perl #4</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/30/my-first-perl-3.html">My First Perl #3</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/29/console-badapple-js.html">Node.jsでコンソールにBad Apple!!を出力してみた</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/27/my-first-perl-2.html">My First Perl #2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/27/my-first-perl-1.html">My First Perl #1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/26/octopress-diff.html">octopress でブログを書いてみる</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/24/title.html">hello world</a>
      </li>
    
  </ul>
</section>


<section>
  <h2>
    Github
    &mdash;
    <a href="https://github.com/nowelium">GitHub</a>
  </h2>
  <ul id="gh_repos">
    <li class="loading">読込中 &#8230;</li>
  </ul>
  
  <a href="https://github.com/nowelium">@nowelium</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'nowelium',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section>
  <h2>
    Tweets
    &mdash;
    <a href="http://twitter.com/nowelium">twitter</a>
  </h2>
  <ul id="tweets">
    <li class="loading">読込中 &#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("nowelium", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/nowelium" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @nowelium</a>
  
</section>





    
  </div>

</div>

</div>

	<!-- /content -->
      </div>

      <footer role="contentinfo">
	<!-- include footer -->
	<p>
  Copyright &copy; 2013 - Yusuke Hata -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <span class="credit">Theme <a href="https://github.com/kui/k-ui-octopress-theme">Octopress Theme for k-ui.jp</a></span>
</p>

	<!-- /include -->
      </footer>
      
      <!-- include after_footer -->
      



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




      <!-- /include -->

    </div>
  </body>
</html>
